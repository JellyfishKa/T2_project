# Тест-план - Неделя 1: LLM Клиенты

## 1. Введение

Этот документ описывает стратегию тестирования модуля LLM Клиентов, который отвечает за взаимодействие с моделями GigaChat, Cotype и T-Pro. Обеспечение надежности и отказоустойчивости является критически важным.

## 2. Объем тестирования (Scope)

- **Компоненты**: `QwenClient`, `LlamaClient`, `TProClient`.
- **Интеграции**: Mock API взаимодействий (без реальных внешних вызовов в юнит-тестах).
- **Целевое покрытие кода (Coverage)**: > 80%.

## 3. Тест-кейсы (Test Cases)

### 3.1. Успешные взаимодействия с API

*Цель*: Проверить, что клиенты корректно парсят валидные ответы.

- **TC-001**: `QwenClient` возвращает текст из валидного JSON ответа.
- **TC-002**: `LlamaClient` возвращает текст из валидного JSON ответа.
- **TC-003**: `TProClient` возвращает текст из валидного JSON ответа.

### 3.2. Обработка ошибок (Error Handling)

*Цель*: Проверить, что клиенты корректно обрабатывают HTTP ошибки.

- **TC-004**: Обработка 400 Bad Request (Неверные параметры).
- **TC-005**: Обработка 401 Unauthorized (Неверный токен).
- **TC-006**: Обработка 429 Too Many Requests (Лимит запросов).
- **TC-007**: Обработка 500 Internal Server Error (Провайдер недоступен).
- **TC-008**: Обработка Network Timeout / Ошибка соединения.

### 3.3. Механизм Fallback (если применимо на уровне клиента или сервиса)

*Цель*: Проверить, что система переключается на резервную модель при сбое.

- **TC-009**: `LLMService` пробует `LlamaClient`, если `QwenClient` падает.
- **TC-010**: `LLMService` пробует `TProClient`, если `LlamaClient` падает.
- **TC-011**: Вызывает `AllModelsFailedException`, если все клиенты падают.

### 3.4. Валидация входных данных

*Цель*: Проверить, что клиенты отклоняют невалидные данные до выполнения запроса.

- **TC-012**: Пустой промпт вызывает `ValueError`.
- **TC-013**: Неверная конфигурация (отсутствует URL/Token) вызывает `ConfigurationError`.

## 4. Инструменты и Инфраструктура

- **Фреймворк**: `pytest`
- **Мокинг**: `unittest.mock` / `pytest-mock`
- **CI/CD**: GitHub Actions
- **Линтинг**: `flake8` / `black` (опционально, но рекомендуется)

## 5. Стратегия выполнения

1. Установить зависимости: `pip install -r backend/requirements/dev/requirements.txt`
2. Запустить тесты: `pytest backend/tests/`
3. Проверить покрытие: `pytest --cov=backend/src backend/tests/`
